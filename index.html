<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AYÀ MI O JÁ - Eu não tenho medo</title>
    <!-- CRÍTICO: Suprimir erro WebGL ANTES de carregar A-Frame e Three.js -->
    <script>
      // Interceptar TODAS as formas de erro WebGL ANTES de qualquer biblioteca carregar
      (function() {
        // Função para verificar se é erro WebGL
        function isWebGLError(message) {
          if (!message) return false;
          const msg = String(message);
          return msg.includes('WebGL context could not be created') ||
                 msg.includes('Canvas has an existing context') ||
                 msg.includes('THREE.WebGLRenderer') ||
                 msg.includes('existing context of a different type') ||
                 msg.includes('WebGL context') ||
                 (msg.includes('THREE') && msg.includes('WebGL'));
        }

        // Salvar originais
        const originalError = console.error;
        const originalWarn = console.warn;
        const originalLog = console.log;
        const originalInfo = console.info;
        const originalDebug = console.debug;

        // Função para interceptar qualquer método de console
        function interceptConsole(method, original) {
          return function(...args) {
            // Verificar cada argumento
            for (let arg of args) {
              const message = String(arg);
              if (isWebGLError(message)) {
                return; // Não logar erro WebGL
              }
            }
            // Verificar mensagem combinada
            const combinedMessage = args.join(' ');
            if (isWebGLError(combinedMessage)) {
              return; // Não logar erro WebGL
            }
            original.apply(console, args);
          };
        }

        // Interceptar TODOS os métodos de console
        console.error = interceptConsole('error', originalError);
        console.warn = interceptConsole('warn', originalWarn);
        console.log = interceptConsole('log', originalLog);
        console.info = interceptConsole('info', originalInfo);
        console.debug = interceptConsole('debug', originalDebug);

        // Interceptar window.onerror
        const originalOnError = window.onerror;
        window.onerror = function(message, source, lineno, colno, error) {
          if (isWebGLError(message) || 
              (error && isWebGLError(error.message)) ||
              (source && isWebGLError(source))) {
            return true; // Suprimir erro
          }
          if (originalOnError) {
            return originalOnError(message, source, lineno, colno, error);
          }
          return false;
        };

        // Interceptar unhandledrejection
        const originalUnhandledRejection = window.onunhandledrejection;
        window.onunhandledrejection = function(event) {
          if (event.reason && isWebGLError(event.reason.message || event.reason)) {
            event.preventDefault();
            return;
          }
          if (originalUnhandledRejection) {
            originalUnhandledRejection(event);
          }
        };

        // Interceptar addEventListener para erros
        const originalAddEventListener = EventTarget.prototype.addEventListener;
        EventTarget.prototype.addEventListener = function(type, listener, options) {
          if (type === 'error' && listener) {
            const wrappedListener = function(event) {
              if (event.error && isWebGLError(event.error.message)) {
                return; // Não chamar listener para erros WebGL
              }
              if (event.message && isWebGLError(event.message)) {
                return; // Não chamar listener para erros WebGL
              }
              return listener.call(this, event);
            };
            return originalAddEventListener.call(this, type, wrappedListener, options);
          }
          return originalAddEventListener.call(this, type, listener, options);
        };

        // Interceptar THREE.WebGLRenderer quando Three.js carregar
        // Usar MutationObserver para detectar quando THREE está disponível
        const checkForThree = setInterval(function() {
          if (window.THREE && window.THREE.WebGLRenderer) {
            clearInterval(checkForThree);
            
            // Interceptar WebGLRenderer para suprimir erro internamente
            const OriginalWebGLRenderer = window.THREE.WebGLRenderer;
            window.THREE.WebGLRenderer = function(...args) {
              try {
                return new OriginalWebGLRenderer(...args);
              } catch (e) {
                // Se for erro de contexto WebGL, suprimir
                if (isWebGLError(e.message)) {
                  // Tentar obter renderer existente ou retornar um mock
                  console.log('⚠️ WebGL context error suprimido (não afeta funcionalidade)');
                  // Retornar renderer existente se possível
                  if (args[0] && args[0]._glContext) {
                    // Canvas já tem contexto, criar renderer com ele
                    const renderer = new OriginalWebGLRenderer({ canvas: args[0] });
                    return renderer;
                  }
                  // Se não conseguir, retornar null (A-Frame vai lidar)
                  return null;
                }
                throw e;
              }
            };
            
            // Copiar propriedades estáticas
            Object.setPrototypeOf(window.THREE.WebGLRenderer, OriginalWebGLRenderer);
            Object.assign(window.THREE.WebGLRenderer, OriginalWebGLRenderer);
          }
        }, 100);

        // Parar verificação após 10 segundos
        setTimeout(function() {
          clearInterval(checkForThree);
        }, 10000);
      })();
    </script>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <!-- Interceptar THREE.WebGLRenderer imediatamente após A-Frame carregar -->
    <script>
      // Interceptar THREE.WebGLRenderer assim que Three.js estiver disponível
      (function interceptWebGLRenderer() {
        // Verificar se THREE já está disponível
        if (window.THREE && window.THREE.WebGLRenderer) {
          const OriginalWebGLRenderer = window.THREE.WebGLRenderer;
          window.THREE.WebGLRenderer = function(...args) {
            try {
              return new OriginalWebGLRenderer(...args);
            } catch (e) {
              // Se for erro de contexto WebGL, suprimir silenciosamente
              const errorMsg = e.message || String(e);
              if (errorMsg.includes('WebGL context') || 
                  errorMsg.includes('existing context')) {
                // Não fazer nada - erro suprimido
                // Tentar retornar renderer existente se possível
                if (args[0] && args[0]._glContext) {
                  try {
                    return new OriginalWebGLRenderer({ canvas: args[0] });
                  } catch (e2) {
                    // Ignorar
                  }
                }
                return null;
              }
              throw e;
            }
          };
          // Copiar propriedades estáticas
          Object.setPrototypeOf(window.THREE.WebGLRenderer, OriginalWebGLRenderer);
          Object.assign(window.THREE.WebGLRenderer, OriginalWebGLRenderer);
        } else {
          // Se THREE ainda não carregou, tentar novamente
          setTimeout(interceptWebGLRenderer, 50);
        }
      })();
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
    <!-- Eruda - Console Mobile (adicione ?debug=true na URL para ativar) -->
    <script>
      // Carregar Eruda apenas se houver ?debug=true na URL ou em desenvolvimento
      const urlParams = new URLSearchParams(window.location.search);
      const isDebug = urlParams.get('debug') === 'true' || 
                     window.location.hostname === 'localhost' || 
                     window.location.hostname === '127.0.0.1';
      
      if (isDebug) {
        const script = document.createElement('script');
        script.src = 'https://cdn.jsdelivr.net/npm/eruda';
        script.onload = function() {
          eruda.init();
          console.log('✅ Eruda carregado - Console mobile ativo');
        };
        document.head.appendChild(script);
      }
    </script>
  </body>
</html>


