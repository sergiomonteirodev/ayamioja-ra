<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AYÀ MI O JÁ - Eu não tenho medo</title>
    <!-- CRÍTICO: Interceptar erros WebGL ANTES de qualquer biblioteca ser carregada -->
    <script>
      // Interceptar HTMLCanvasElement.getContext ANTES de qualquer código ser executado
      (function() {
        if (HTMLCanvasElement && !HTMLCanvasElement.prototype._originalGetContext) {
          HTMLCanvasElement.prototype._originalGetContext = HTMLCanvasElement.prototype.getContext;
          HTMLCanvasElement.prototype.getContext = function(contextType, ...args) {
            if (contextType === 'webgl' || contextType === 'webgl2' || contextType === 'experimental-webgl') {
              // Verificar se já existe um contexto armazenado
              if (this._glContext && !this._glContext.isContextLost()) {
                return this._glContext;
              }
              
              // Tentar obter contexto existente do A-Frame se disponível
              try {
                const scene = document.querySelector('a-scene');
                if (scene && scene.systems && scene.systems.renderer) {
                  const renderer = scene.systems.renderer.renderer || scene.systems.renderer;
                  if (renderer && typeof renderer.getContext === 'function') {
                    const existingGl = renderer.getContext();
                    if (existingGl && !existingGl.isContextLost()) {
                      this._glContext = existingGl;
                      return existingGl;
                    }
                  }
                }
              } catch (e) {
                // Ignorar
              }
              
              // Tentar criar novo contexto
              try {
                const context = this._originalGetContext.call(this, contextType, ...args);
                if (context) {
                  this._glContext = context;
                }
                return context;
              } catch (e) {
                // Se falhar, retornar null em vez de lançar erro
                if (this._glContext && !this._glContext.isContextLost()) {
                  return this._glContext;
                }
                return null;
              }
            }
            return this._originalGetContext.call(this, contextType, ...args);
          };
        }
        
        // Interceptar console.error e console.warn ANTES de qualquer código
        if (!window._webglErrorSuppressed) {
          const originalError = console.error.bind(console);
          const originalWarn = console.warn.bind(console);
          
          const shouldSuppress = (...args) => {
            const fullMessage = args.map(arg => {
              if (typeof arg === 'string') return arg;
              if (arg && typeof arg === 'object') {
                if (arg.message) return arg.message;
                if (arg.toString) return arg.toString();
                try {
                  return JSON.stringify(arg);
                } catch (e) {
                  return String(arg);
                }
              }
              return String(arg);
            }).join(' ');
            
            const lowerMessage = fullMessage.toLowerCase();
            // Verificação ULTRA AGRESSIVA - capturar qualquer coisa relacionada a WebGL context
            const hasWebGL = lowerMessage.includes('webgl');
            const hasContext = lowerMessage.includes('context');
            const hasExisting = lowerMessage.includes('existing') || lowerMessage.includes('already');
            const hasDifferent = lowerMessage.includes('different') || lowerMessage.includes('type');
            const hasCouldNot = lowerMessage.includes('could not') || lowerMessage.includes('cannot');
            const hasThree = lowerMessage.includes('three') || lowerMessage.includes('webglrenderer');
            
            // Se tem WebGL + context + (existing/different/could not), suprimir
            if (hasWebGL && hasContext && (hasExisting || hasDifferent || hasCouldNot)) {
              return true;
            }
            
            // Se tem THREE + WebGLRenderer + context, suprimir
            if (hasThree && hasWebGL && hasContext) {
              return true;
            }
            
            // Verificações específicas
            return lowerMessage.includes('webgl context could not be created') || 
                   lowerMessage.includes('existing context of a different type') ||
                   lowerMessage.includes('canvas has an existing context') ||
                   (lowerMessage.includes('three.webglrenderer') && lowerMessage.includes('existing context')) ||
                   (lowerMessage.includes('webgl') && lowerMessage.includes('existing context')) ||
                   (lowerMessage.includes('three.webglrenderer') && lowerMessage.includes('canvas has an existing')) ||
                   (lowerMessage.includes('webgl') && lowerMessage.includes('could not be created')) ||
                   (lowerMessage.includes('webgl') && lowerMessage.includes('context') && lowerMessage.includes('different')) ||
                   lowerMessage.includes('webgl context') && (lowerMessage.includes('error') || lowerMessage.includes('failed'));
          };
          
          console.error = function(...args) {
            // Verificar se deve suprimir ANTES de processar
            const fullMessage = args.map(arg => {
              if (typeof arg === 'string') return arg;
              if (arg && typeof arg === 'object') {
                if (arg.message) return arg.message;
                if (arg.toString) return arg.toString();
                try {
                  return JSON.stringify(arg);
                } catch (e) {
                  return String(arg);
                }
              }
              return String(arg);
            }).join(' ');
            
            // Verificação direta e rápida - ULTRA AGRESSIVA
            const lowerMessage = fullMessage.toLowerCase();
            // Capturar qualquer coisa com THREE.WebGLRenderer e context
            if (lowerMessage.includes('three') && lowerMessage.includes('webglrenderer') && lowerMessage.includes('context')) {
              return;
            }
            // Capturar qualquer coisa com webgl + context + existing/different/could not
            if (lowerMessage.includes('webgl') && lowerMessage.includes('context') && 
                (lowerMessage.includes('existing') || lowerMessage.includes('different') || 
                 lowerMessage.includes('could not') || lowerMessage.includes('cannot') ||
                 lowerMessage.includes('reason'))) {
              // Suprimir completamente - não mostrar no console
              return;
            }
            
            // Verificar com função completa
            if (shouldSuppress(...args)) {
              return;
            }
            originalError.apply(console, args);
          };
          
          console.warn = function(...args) {
            // Mesma verificação para warn
            const fullMessage = args.map(arg => {
              if (typeof arg === 'string') return arg;
              if (arg && typeof arg === 'object') {
                if (arg.message) return arg.message;
                if (arg.toString) return arg.toString();
                try {
                  return JSON.stringify(arg);
                } catch (e) {
                  return String(arg);
                }
              }
              return String(arg);
            }).join(' ');
            
            const lowerMessage = fullMessage.toLowerCase();
            // Capturar qualquer coisa com THREE.WebGLRenderer e context
            if (lowerMessage.includes('three') && lowerMessage.includes('webglrenderer') && lowerMessage.includes('context')) {
              return;
            }
            // Capturar qualquer coisa com webgl + context + existing/different/could not
            if (lowerMessage.includes('webgl') && lowerMessage.includes('context') && 
                (lowerMessage.includes('existing') || lowerMessage.includes('different') || 
                 lowerMessage.includes('could not') || lowerMessage.includes('cannot') ||
                 lowerMessage.includes('reason'))) {
              return;
            }
            
            if (shouldSuppress(...args)) {
              return;
            }
            originalWarn.apply(console, args);
          };
          
          window.onerror = function(message, source, lineno, colno, error) {
            if (shouldSuppress(message || '', error?.message || '', error?.stack || '')) {
              return true;
            }
            return false;
          };
          
          window.addEventListener('unhandledrejection', function(event) {
            const reason = event.reason;
            if (shouldSuppress(String(reason), reason?.message || '', reason?.stack || '')) {
              event.preventDefault();
            }
          });
          
          window._webglErrorSuppressed = true;
        }
      })();
    </script>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
    <!-- Eruda - Console Mobile (adicione ?debug=true na URL para ativar) -->
    <script>
      // Carregar Eruda apenas se houver ?debug=true na URL ou em desenvolvimento
      const urlParams = new URLSearchParams(window.location.search);
      const isDebug = urlParams.get('debug') === 'true' || 
                     window.location.hostname === 'localhost' || 
                     window.location.hostname === '127.0.0.1';
      
      if (isDebug) {
        const script = document.createElement('script');
        script.src = 'https://cdn.jsdelivr.net/npm/eruda';
        script.onload = function() {
          eruda.init();
          console.log('✅ Eruda carregado - Console mobile ativo');
        };
        document.head.appendChild(script);
      }
    </script>
  </body>
</html>


